/*! HMM 08-01-2015 */
!function(a,b){"use strict";var c=function(a){this.config={states:[],symbols:[],transitionProbabilities:{},emissionProbabilities:{},startProbability:{},matchFactor:.05};for(var c in a)this.config[c]=a[c];var d=function(a){this.config.states.forEach(a)}.bind(this),e=function(a,b,c){var d,e=Object.keys(a),f=0;return e.forEach(function(c){d=Object.keys(a[c]),d.forEach(function(d){f+=Math.abs(a[c][d]-b[c][d])})}),c>f},f=function(){return 0};this.calculatePath=function(a){var c=a.slice(0),e=[{}],f={};d(function(a){e[0][a]=this.config.startProbability[a]*this.config.emissionProbabilities[a][c[0]],f[a]=[a]}.bind(this)),c.splice(0,1),c.forEach(function(a,c){e.push({});var g={};d(function(h){var i=[0,b];d(function(b){var d=e[c][b]*this.config.transitionProbabilities[b][h]*this.config.emissionProbabilities[h][a];d>=i[0]&&(i=[d,b])}.bind(this)),e[c+1][h]=i[0],g[h]=f[i[1]].concat(h)}.bind(this)),f=g}.bind(this));var g=[-1,b];return d(function(a){var b=e[c.length][a];g[0]<b&&(g=[b,a])}.bind(this)),[g[0],f[g[1]]]},this.teach=function(a){var b,c,g=function(a){var b=this.calculatePath(a);return b[1]}.bind(this),h=0,i=0,j=function(b,c){for(var d=a[c],e=0;e<b.length-1;e++){var f=b[e],g=b[e+1];this.config.transitionProbabilities[f][g]=this.config.transitionProbabilities[f][g]+1,this.config.emissionProbabilities[f][d[e]]=this.config.emissionProbabilities[f][d[e]]+1,h+=1,i+=1}var j=b.length-1;this.config.emissionProbabilities[b[j]][d[j]]=this.config.emissionProbabilities[b[j]][d[j]]+1,i+=1}.bind(this),k=function(a){d(function(b){this.config.transitionProbabilities[a][b]=this.config.transitionProbabilities[a][b]/h}.bind(this)),this.config.symbols.forEach(function(b){this.config.emissionProbabilities[a][b]=this.config.emissionProbabilities[a][b]/i}.bind(this))}.bind(this);do{var l=a.map(g);h=0,i=0,b=this.config.emissionProbabilities,c=this.config.transitionProbabilities,this.createProbabilitiesMatix(f,f),l.forEach(j),d(k)}while(!e(c,this.config.transitionProbabilities,this.config.matchFactor)||!e(b,this.config.emissionProbabilities,this.config.matchFactor))},this.initializeDefaultProbabilities=function(){this.createProbabilitiesMatix(Math.random,Math.random)},this.initializeDiagonalProbabilities=function(){d(function(a,b){this.config.transitionProbabilities[a]={},this.config.emissionProbabilities[a]={};for(var c=Math.min(this.config.states.length-1,b+1),d=Math.max(0,b-1),e=d;c>=e;e++){var f=this.config.states[e];this.config.transitionProbabilities[a][f]=Math.random()}this.config.symbols.forEach(function(b){this.config.emissionProbabilities[a][b]=Math.random()}.bind(this))}.bind(this))},this.createProbabilitiesMatix=function(a,b){d(function(c){this.config.transitionProbabilities[c]={},this.config.emissionProbabilities[c]={},d(function(b){this.config.transitionProbabilities[c][b]=a()}.bind(this)),this.config.symbols.forEach(function(a){this.config.emissionProbabilities[c][a]=b()}.bind(this))}.bind(this))}};c.VERSION="0.0.5",a.HMM=c;var d=function(a){this.config={standardHiddenMarkovModel:c,minimalProbabilityFactor:.95,minimalLengthFactor:.95};for(var b in a)this.config[b]=a[b];this.standardHiddenMarkovModel=new this.config.standardHiddenMarkovModel(this.config);var d=[],e=[];this.calculatePath=function(a){return this.standardHiddenMarkovModel.calculatePath(a)},this.newSymbol=function(a){d.push([]),d.forEach(function(b){b.push(a)}.bind(this));var b=!1;d=d.filter(function(a){var c=this.calculatePath(a);return a.length>=this.averageObservationLength*this.config.minimalLengthFactor&&!b&&c[0]>this.averageProbability*this.config.minimalProbabilityFactor&&(b=!0,e.forEach(function(a){a(c)})),c[0]<this.averageProbability*this.config.minimalProbabilityFactor?!1:!b}.bind(this))},this.onDetect=function(a){e.push(a)},this.reset=function(){d=[]},this.teach=function(a){this.averageObservationLength=a.reduce(function(a,b){return a+b.length},0)/a.length,this.standardHiddenMarkovModel.teach(a),this.averageProbability=a.map(function(a){return this.calculatePath(a)}.bind(this)).map(function(a){return a[0]}).reduce(function(a,b){return a+b},0)/a.length},this.initializeDefaultProbabilities=function(){this.standardHiddenMarkovModel.initializeDefaultProbabilities()},this.initializeDiagonalProbabilities=function(){this.standardHiddenMarkovModel.initializeDiagonalProbabilities()},this.createProbabilitiesMatix=function(a,b){this.standardHiddenMarkovModel.initializeDiagonalProbabilities(a,b)}};d.VERSION="0.0.5",a.ContinousHMM=d;var e=function(a){this.config={singularModel:d,modelInitializer:function(a){a.initializeDefaultProbabilities()}};for(var c in a)this.config[c]=a[c];var e={},f=[],g=[];this.reset=function(){f.forEach(function(a){e[a].reset()})},this.calculatePath=function(a){return f.map(function(b){return{name:b,data:e[b].calculatePath(a)}}).reduce(function(a,b){return b.data[0]>a.data[0]?b:a},{name:b,data:[-1]})},this.newSymbol=function(a){f.forEach(function(b){e[b].newSymbol(a)})},this.onDetect=function(a,b){b?e[b].onDetect(a):(f.forEach(function(b){e[b].onDetect(function(c){a({name:b,data:c})})}),g.push(a))},this.teach=function(a,b){var c=new this.config.singularModel(this.config);this.config.modelInitializer(c),c.teach(b),e[a]=c,f.push(a),g.forEach(function(b){c.onDetect(function(c){b({name:a,data:c})})})}};e.VERSION="0.0.5",a.MultiGestureHMM=e}(this);