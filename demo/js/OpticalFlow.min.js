/*! OpticalFlow 30-12-2014 */
!function(a){"use strict";var b=function(a){this.config={width:640,height:480,alpha:5,iterations:2};for(var b in a)this.config[b]=a[b];var c=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=new Uint8ClampedArray(d.length/4),f=+d.length,g=0,h=0;f>g;g+=4,h++)e[h]=.299*d[g]+.587*d[g+1]+.114*d[g+2];b[c]=e}return b}.bind(this),d=function(a,b){return a+b*this.config.width}.bind(this),e=function(a,b){for(var c=+this.config.width,d=+this.config.height,e=0;c>e;e++){a[e]=new Float64Array(d),b[e]=new Float64Array(d);for(var f=0;d>f;f++)a[e][f]=0,b[e][f]=0}}.bind(this);this.getFlowData=function(a){var b=c(a),f=[],g=[],h=0,i=0,j=+this.config.width,k=+this.config.height,l=+this.config.iterations;e(f,g);var m,n,o=[],p=[],q=[];for(m=1;j-1>m;m++)for(o[m]=new Float64Array(k),p[m]=new Float64Array(k),q[m]=new Float64Array(k),n=1;k-1>n;n++)o[m][n]=(b[0][d(m+1,n+1)]-b[0][d(m,n+1)]+b[0][d(m+1,n)]-b[0][d(m,n)]+b[1][d(m+1,n+1)]-b[1][d(m,n+1)]+b[1][d(m+1,n)]-b[1][d(m,n)])/4,p[m][n]=(b[0][d(m,n)]-b[0][d(m,n+1)]+b[0][d(m+1,n)]-b[0][d(m+1,n+1)]+b[1][d(m,n)]-b[1][d(m,n+1)]+b[1][d(m+1,n)]-b[1][d(m+1,n+1)])/4,q[m][n]=(b[1][d(m,n+1)]-b[0][d(m,n+1)]+b[1][d(m,n)]-b[0][d(m,n)]+b[1][d(m+1,n+1)]-b[0][d(m+1,n+1)]+b[1][d(m+1,n)]-b[0][d(m+1,n)])/4;for(var r=0;l>r;r++)for(h=0,i=0,m=1;j-1>m;m++)for(n=1;k-1>n;n++){var s=(f[m][n-1]+f[m+1][n]+f[m][n+1]+f[m-1][n])/6+(f[m-1][n-1]+f[m+1][m-1]+f[m+1][n+1]+f[m-1][n+1])/12,t=(g[m][n-1]+g[m+1][n]+g[m][n+1]+g[m-1][n])/6+(g[m-1][n-1]+g[m+1][m-1]+g[m+1][n+1]+g[m-1][n+1])/12,u=(o[m][n]*s+p[m][n]*t+q[m][n])/(Math.pow(this.config.alpha,2)+Math.pow(o[m][n],2)+Math.pow(p[m][n],2));s=isNaN(s)?0:s,t=isNaN(t)?0:t,u=isNaN(u)?0:u,f[m][n]=s-o[m][n]*u,g[m][n]=t-p[m][n]*u,h+=f[m][n],i+=g[m][n]}var v=j*k,w=h/v,x=i/v;return{xFlows:f,yFlows:g,xAvg:w,yAvg:x}}};b.VERSION="0.0.1",a.OpticalFlow=b}(this);